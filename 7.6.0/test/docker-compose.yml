version: '2.1'

services:
    tomcat-h2:
        image: menski/whynot:tomcat-${VERSION:-7.6.0}
        environment:
            - JAVA_OPTS=-Djava.security.egd=file:/dev/./urandom
        ports:
            - "8080:8080"
        restart: always

    tomcat-alpine-h2:
        image: menski/whynot:tomcat-${VERSION:-7.6.0}-alpine
        environment:
            - JAVA_OPTS=-Djava.security.egd=file:/dev/./urandom
        ports:
            - "8080:8080"
        restart: always

    wildfly-h2:
        image: menski/whynot:wildfly-${VERSION:-7.6.0}
        ports:
            - "8080:8080"
        restart: always

    wildfly-alpine-h2:
        image: menski/whynot:wildfly-${VERSION:-7.6.0}
        ports:
            - "8080:8080"
        restart: always

    tomcat-mysql:
        image: menski/whynot:tomcat-${VERSION:-7.6.0}
        environment:
            - JAVA_OPTS=-Djava.security.egd=file:/dev/./urandom
            - DB_DRIVER=com.mysql.jdbc.Driver
            - DB_URL=jdbc:mysql://mysql:3306/process-engine
            - DB_USERNAME=camunda
            - DB_PASSWORD=camunda
        links:
            - mysql
        ports:
            - "8080:8080"
        volumes:
            - $PWD/wait-for-it.sh:/bin/wait-for-it.sh
        restart: always
        command:
            - /bin/wait-for-it.sh
            - mysql:3306
            - "-s"
            - "--"
            - /usr/local/bin/configure-and-run.sh

    tomcat-alpine-mysql:
        image: menski/whynot:tomcat-${VERSION:-7.6.0}-alpine
        environment:
            - JAVA_OPTS=-Djava.security.egd=file:/dev/./urandom
            - DB_DRIVER=com.mysql.jdbc.Driver
            - DB_URL=jdbc:mysql://mysql:3306/process-engine
            - DB_USERNAME=camunda
            - DB_PASSWORD=camunda
        links:
            - mysql
        ports:
            - "8080:8080"
        volumes:
            - $PWD/wait-for-it.sh:/bin/wait-for-it.sh
        restart: always
        command:
            - /bin/wait-for-it.sh
            - mysql:3306
            - "-s"
            - "--"
            - /usr/local/bin/configure-and-run.sh

    wildfly-mysql:
        image: menski/whynot:wildfly-${VERSION:-7.6.0}
        environment:
            - DB_DRIVER=com.mysql.jdbc.Driver
            - DB_URL=jdbc:mysql://mysql:3306/process-engine
            - DB_USERNAME=camunda
            - DB_PASSWORD=camunda
        links:
            - mysql
        ports:
            - "8080:8080"
        volumes:
            - $PWD/wait-for-it.sh:/bin/wait-for-it.sh
        restart: always
        command:
            - /bin/wait-for-it.sh
            - mysql:3306
            - "-s"
            - "--"
            - /usr/local/bin/configure-and-run.sh

    wildfly-alpine-mysql:
        image: menski/whynot:wildfly-${VERSION:-7.6.0}-alpine
        environment:
            - DB_DRIVER=com.mysql.jdbc.Driver
            - DB_URL=jdbc:mysql://mysql:3306/process-engine
            - DB_USERNAME=camunda
            - DB_PASSWORD=camunda
        links:
            - mysql
        ports:
            - "8080:8080"
        volumes:
            - $PWD/wait-for-it.sh:/bin/wait-for-it.sh
        restart: always
        command:
            - /bin/wait-for-it.sh
            - mysql:3306
            - "-s"
            - "--"
            - /usr/local/bin/configure-and-run.sh

    tomcat-postgresql:
        image: menski/whynot:tomcat-${VERSION:-7.6.0}
        environment:
            - JAVA_OPTS=-Djava.security.egd=file:/dev/./urandom
            - DB_DRIVER=org.postgresql.Driver
            - DB_URL=jdbc:postgresql://postgresql:5432/camunda
            - DB_USERNAME=camunda
            - DB_PASSWORD=camunda
        links:
            - postgresql
        ports:
            - "8080:8080"
        volumes:
            - $PWD/wait-for-it.sh:/bin/wait-for-it.sh
        restart: always
        command:
            - /bin/wait-for-it.sh
            - postgresql:5432
            - "-s"
            - "--"
            - /usr/local/bin/configure-and-run.sh

    tomcat-alpine-postgresql:
        image: menski/whynot:tomcat-${VERSION:-7.6.0}-alpine
        environment:
            - JAVA_OPTS=-Djava.security.egd=file:/dev/./urandom
            - DB_DRIVER=org.postgresql.Driver
            - DB_URL=jdbc:postgresql://postgresql:5432/camunda
            - DB_USERNAME=camunda
            - DB_PASSWORD=camunda
        links:
            - postgresql
        ports:
            - "8080:8080"
        volumes:
            - $PWD/wait-for-it.sh:/bin/wait-for-it.sh
        restart: always
        command:
            - /bin/wait-for-it.sh
            - postgresql:5432
            - "-s"
            - "--"
            - /usr/local/bin/configure-and-run.sh

    wildfly-postgresql:
        image: menski/whynot:wildfly-${VERSION:-7.6.0}
        environment:
            - DB_DRIVER=org.postgresql.Driver
            - DB_URL=jdbc:postgresql://postgresql:5432/camunda
            - DB_USERNAME=camunda
            - DB_PASSWORD=camunda
        links:
            - postgresql
        ports:
            - "8080:8080"
        volumes:
            - $PWD/wait-for-it.sh:/bin/wait-for-it.sh
        restart: always
        command:
            - /bin/wait-for-it.sh
            - postgresql:5432
            - "-s"
            - "--"
            - /usr/local/bin/configure-and-run.sh

    wildfly-alpine-postgresql:
        image: menski/whynot:wildfly-${VERSION:-7.6.0}-alpine
        environment:
            - JAVA_OPTS=-Djava.security.egd=file:/dev/./urandom
            - DB_DRIVER=org.postgresql.Driver
            - DB_URL=jdbc:postgresql://postgresql:5432/camunda
            - DB_USERNAME=camunda
            - DB_PASSWORD=camunda
        links:
            - postgresql
        ports:
            - "8080:8080"
        volumes:
            - $PWD/wait-for-it.sh:/bin/wait-for-it.sh
        restart: always
        command:
            - /bin/wait-for-it.sh
            - postgresql:5432
            - "-s"
            - "--"
            - /usr/local/bin/configure-and-run.sh

    mysql:
        image: mysql
        environment:
            - MYSQL_ROOT_PASSWORD=camunda
            - MYSQL_USER=camunda
            - MYSQL_PASSWORD=camunda
            - MYSQL_DATABASE=process-engine

    postgresql:
        image: postgres
        environment:
            - POSTGRES_USER=camunda
            - POSTGRES_PASSWORD=camunda
